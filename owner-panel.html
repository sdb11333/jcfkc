<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Панель основателя</title>
    <link rel="stylesheet" href="styles.css">
    <script>
        // Логика для проверки роли пользователя при загрузке страницы
        window.onload = function() {
            const userRole = localStorage.getItem('userRole');
            if (userRole !== 'owner') {
                window.location.href = 'login.html'; // Перенаправление, если пользователь не основатель
            }

            loadContent(); // Загружаем сохраненный контент сайта при открытии панели
        };

        // Функция для редактирования текста сайта
        function editSiteContent() {
            const newTitle = prompt("Введите новый заголовок сайта:");
            const newDescription = prompt("Введите новое описание сайта:");

            if (newTitle) {
                localStorage.setItem('siteTitle', newTitle); // Сохраняем новый заголовок в localStorage
            }

            if (newDescription) {
                localStorage.setItem('siteDescription', newDescription); // Сохраняем новое описание в localStorage
            }

            alert("Изменения сохранены!");
            loadContent(); // Загружаем обновленный контент
        }

        // Функция для загрузки контента с сайта
        function loadContent() {
            const savedTitle = localStorage.getItem('siteTitle') || 'Добро пожаловать на сайт!';
            const savedDescription = localStorage.getItem('siteDescription') || 'Это основной сайт, доступный всем пользователям.';

            document.getElementById('siteTitle').innerText = savedTitle;
            document.getElementById('siteDescription').innerText = savedDescription;
        }

        // Функция для блокировки пользователя
        function blockUser() {
            const username = prompt("Введите имя пользователя для блокировки:");
            const duration = prompt("Введите длительность блокировки в минутах:");

            if (username && duration) {
                const blockUntil = new Date().getTime() + (duration * 60000); // Блокировка на определенное время
                const blockedUsers = JSON.parse(localStorage.getItem('blockedUsers')) || [];
                blockedUsers.push({ username, blockUntil });
                localStorage.setItem('blockedUsers', JSON.stringify(blockedUsers)); // Сохраняем список заблокированных пользователей

                logAction(`Основатель заблокировал пользователя ${username} на ${duration} минут`);
                alert(`Пользователь ${username} заблокирован на ${duration} минут.`);
            }
        }

        // Функция для проверки блокированных пользователей
        function checkBlockedUsers() {
            const blockedUsers = JSON.parse(localStorage.getItem('blockedUsers')) || [];
            const currentTime = new Date().getTime();

            // Удаляем заблокированных пользователей, у которых срок блокировки истек
            const activeBlockedUsers = blockedUsers.filter(user => user.blockUntil > currentTime);

            // Обновляем данные заблокированных пользователей в localStorage
            localStorage.setItem('blockedUsers', JSON.stringify(activeBlockedUsers));

            if (activeBlockedUsers.length > 0) {
                alert(`Заблокированные пользователи: ${activeBlockedUsers.map(user => user.username).join(', ')}`);
            }
        }

        // Функция для логирования действий
        function logAction(action) {
            const date = new Date().toLocaleString();
            const user = localStorage.getItem('userRole');
            const logEntry = { date, user, action };

            let logs = JSON.parse(localStorage.getItem('logs')) || [];
            logs.push(logEntry);
            localStorage.setItem('logs', JSON.stringify(logs));

            // Выводим логи в консоль
            console.log(logEntry);
        }

        // Функция для вывода всех заблокированных пользователей
        function showBlockedUsers() {
            const blockedUsers = JSON.parse(localStorage.getItem('blockedUsers')) || [];

            if (blockedUsers.length > 0) {
                alert(`Заблокированные пользователи: ${blockedUsers.map(user => user.username).join(', ')}`);
            } else {
                alert("Нет заблокированных пользователей.");
            }
        }

        // Функция для присвоения роли пользователю
        function assignRole() {
            const username = prompt("Введите имя пользователя:");
            const role = prompt("Введите роль пользователя (admin/moderator/user):");

            if (username && role) {
                const users = JSON.parse(localStorage.getItem('users')) || [];
                let user = users.find(u => u.username === username);

                if (!user) {
                    user = { username, role: 'user' }; // По умолчанию роль 'user'
                    users.push(user);
                } else {
                    user.role = role; // Обновляем роль
                }

                localStorage.setItem('users', JSON.stringify(users)); // Сохраняем список пользователей
                logAction(`Основатель присвоил пользователю ${username} роль ${role}`);
                alert(`Роль для пользователя ${username} изменена на ${role}.`);
            }
        }

        // Функция для отображения всех пользователей и их ролей
        function showUsers() {
            const users = JSON.parse(localStorage.getItem('users')) || [];

            if (users.length > 0) {
                alert(`Пользователи и их роли: ${users.map(user => `${user.username}: ${user.role}`).join(', ')}`);
            } else {
                alert("Нет пользователей.");
            }
        }
    </script>
</head>
<body>

    <header>
        <h1>Панель основателя</h1>
        <button onclick="editSiteContent()">Редактировать контент сайта</button>
        <button onclick="blockUser()">Заблокировать пользователя</button>
        <button onclick="showBlockedUsers()">Показать заблокированных пользователей</button>
        <button onclick="assignRole()">Присвоить роль пользователю</button>
        <button onclick="showUsers()">Показать всех пользователей</button>
        <button onclick="logout()">Выйти</button>
    </header>

    <section id="siteContent">
        <h2 id="siteTitle">Добро пожаловать на сайт!</h2>
        <p id="siteDescription">Это основной сайт, доступный всем пользователям.</p>
    </section>

    <footer>
        <p>© 2025 Все права защищены</p>
    </footer>

</body>
</html>
